<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>웰니스 더 한남 (Wellness,The Hannam)</title>
    <meta property="og:title" content="웰니스,더 한남 멤버십" />
    <meta property="og:description" content="한남동 프리미엄 웰니스 케어 서비스 예약 및 안내" />
    <meta property="og:image" content="/pwa-icon-v3.png" />
    <meta property="og:type" content="website" />
    <link rel="manifest" href="/manifest.json?v=3" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" />
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@1,600;1,700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --brand-ivory: #F9F9F7;
            --brand-deep-green: #1A3C34;
            --brand-gold: #A58E6F;
            --brand-charcoal: #2D2D2D;
            --brand-border: #E8E8E4;
        }

        body {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif;
            background-color: var(--brand-ivory);
            color: var(--brand-charcoal);
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
            letter-spacing: -0.01em;
        }

        .font-serif-luxury {
            font-family: 'Cormorant Garamond', serif;
            font-style: italic;
        }

        ::-webkit-scrollbar {
            width: 0px;
        }

        .page-transition {
            animation: fadeIn 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .luxury-shadow {
            box-shadow: 0 10px 30px -10px rgba(26, 60, 52, 0.08);
        }

        .card-rounded {
            border-radius: 20px;
        }

        #fallback-message {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
            gap: 20px;
            color: #1A3C34;
        }
    </style>
    <script type="importmap">
{
  "imports": {
    "react-router-dom": "https://esm.sh/react-router-dom@^7.11.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3",
    "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@^2.89.0",

    "react-signature-canvas": "https://esm.sh/react-signature-canvas@^1.1.0-alpha.2"
  }
}
</script>
</head>


<body>
    <div id="kakao-overlay"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #F9F9F7; z-index: 9999; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px;">
        <h2 style="font-size: 20px; font-weight: bold; color: #1A3C34; margin-bottom: 20px;">원활한 접속을 위해<br>다른 브라우저를
            이용해주세요
        </h2>
        <p style="font-size: 14px; color: #666; margin-bottom: 30px; line-height: 1.6;">
            현재 카카오톡 인앱 브라우저에서는<br>보안 정책으로 인해 일부 기능이 제한됩니다.<br>
            <strong>Safari</strong> 또는 <strong>Chrome</strong>으로 접속해주세요.
        </p>
        <div style="display: flex; gap: 10px;">
            <button onclick="location.href=location.href"
                style="padding: 15px 30px; background: #1A3C34; color: white; border-radius: 12px; border: none; font-weight: bold; font-size: 14px;">
                새로고침
            </button>
            <button onclick="document.getElementById('kakao-overlay').style.display='none'"
                style="padding: 15px 30px; background: #E8E8E4; color: #1A3C34; border-radius: 12px; border: none; font-weight: bold; font-size: 14px;">
                닫기
            </button>
        </div>
        <p style="font-size: 12px; color: #999; margin-top: 20px;">화면이 계속 하얗게 보인다면<br>우측 하단 [ ... ] > [다른 브라우저로 열기]</p>
    </div>

    <script>
        // [CRITICAL] Global Error Handler & Environment Check
        window.onerror = function (msg, url, lineNo, columnNo, error) {
            var fallback = document.getElementById('fallback-message');
            if (fallback) {
                fallback.innerHTML = `
                        <h1 style="color: #1A3C34;">System Error</h1>
                        <p style="color: red; font-size: 12px; text-align: left; background: #eee; padding: 10px; border-radius: 8px;">
                            ${msg}<br>
                            ${url}:${lineNo}
                        </p>
                        <button onclick="window.location.reload()" style="padding: 10px 20px; background: #1A3C34; color: white; border-radius: 8px; border: none;">Reload</button>
                    `;
                fallback.style.display = 'flex';
            }
            return false;
        };

        // [KAKAO CHECK]
        (function () {
            var ua = navigator.userAgent;
            var isKakao = /KAKAOTALK|DaumApps/i.test(ua);
            if (isKakao) {
                var overlay = document.getElementById('kakao-overlay');
                if (overlay) overlay.style.display = 'flex';

                // Block Service Worker
                if ('serviceWorker' in navigator) {
                    // Mock to prevent errors
                    navigator.serviceWorker = {
                        register: function () { return new Promise(function () { }); },
                        ready: new Promise(function () { })
                    };
                }
            }
        })();
    </script>
    <div id="root">
        <div id="fallback-message">
            <h1 style="font-size: 24px; font-weight: bold;">Wellness, The Hannam</h1>
            <p>Loading...</p>
            <p style="font-size: 12px; color: #999;">화면이 멈춰있다면 아래 버튼을 눌러주세요</p>
            <button onclick="window.location.href='/?t='+Date.now()"
                style="padding: 10px 20px; background: #1A3C34; color: white; border-radius: 8px; border: none;">새로고침</button>
        </div>
    </div>
    <script type="module" src="index.tsx"></script>
    <script>
        // [CRITICAL FIX] Service Worker Management & Kakao Compatibility
        // Version: 2026.01.28.v9 (HEAD Injection + Mock Object)
        (function () {
            const ua = navigator.userAgent;
            const isKakao = /KAKAOTALK|DaumApps/i.test(ua);

            // 1. KAKAOTALK/NATIVE APP SPECIFIC FIX
            if (isKakao) {
                console.warn('[System] Native App (Kakao) detected. PREVENTING Service Workers.');

                // Mock the API to prevent crashes while disabling functionality
                const dummySW = {
                    register: function () {
                        console.log('[System] SW registration blocked (Kakao)');
                        return new Promise(() => { }); // Never resolve/reject matches "hanging" but better than crash? Or just resolve null.
                        // User wants 100% disable.
                        return Promise.resolve(null);
                    },
                    getRegistrations: function () { return Promise.resolve([]); },
                    ready: new Promise(() => { }) // Never ready
                };

                try {
                    // Try to unregister real ones if they exist
                    if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                        navigator.serviceWorker.getRegistrations().then(regs => {
                            regs.forEach(r => r.unregister());
                        });
                    }

                    // OVERRIDE the API
                    Object.defineProperty(navigator, 'serviceWorker', {
                        value: dummySW,
                        writable: false,
                        configurable: false
                    });
                    console.log('[System] navigator.serviceWorker Replaced with Mock');

                } catch (e) {
                    console.error('[System] Failed to mock SW', e);
                }
                return;
            }

            // 2. GENERAL CLEANUP (Non-Kakao)
            const RESET_KEY = 'wellness_reset_v9';
            if (!localStorage.getItem(RESET_KEY)) {
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.getRegistrations().then(regs => regs.forEach(r => r.unregister()));
                }
                if ('caches' in window) {
                    caches.keys().then(keys => Promise.all(keys.map(k => caches.delete(k))));
                }
                localStorage.setItem(RESET_KEY, 'true');
                console.log('[System] Cache Reset Complete (v9)');
            }

            // 3. Register Service Worker for PWA/Push (Non-Kakao)
            if ('serviceWorker' in navigator && !isKakao) {
                window.addEventListener('load', function () {
                    navigator.serviceWorker.register('/firebase-messaging-sw.js')
                        .then(function (registration) {
                            console.log('Service Worker Registered with scope:', registration.scope);
                        })
                        .catch(function (err) {
                            console.error('Service Worker registration failed:', err);
                        });
                });
            }
        })();
    </script>
</body>

</html>