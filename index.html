<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>웰니스 더 한남 (Wellness,The Hannam)</title>
    <meta property="og:title" content="웰니스,더 한남 멤버십" />
    <meta property="og:description" content="한남동 프리미엄 웰니스 케어 서비스 예약 및 안내" />
    <meta property="og:image" content="/pwa-icon-v2.png" />
    <meta property="og:type" content="website" />
    <link rel="manifest" href="/manifest.json?v=2" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" />
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@1,600;1,700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --brand-ivory: #F9F9F7;
            --brand-deep-green: #1A3C34;
            --brand-gold: #A58E6F;
            --brand-charcoal: #2D2D2D;
            --brand-border: #E8E8E4;
        }

        body {
            font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif;
            background-color: var(--brand-ivory);
            color: var(--brand-charcoal);
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
            letter-spacing: -0.01em;
        }

        .font-serif-luxury {
            font-family: 'Cormorant Garamond', serif;
            font-style: italic;
        }

        ::-webkit-scrollbar {
            width: 0px;
        }

        .page-transition {
            animation: fadeIn 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .luxury-shadow {
            box-shadow: 0 10px 30px -10px rgba(26, 60, 52, 0.08);
        }

        .card-rounded {
            border-radius: 20px;
        }

        #fallback-message {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
            gap: 20px;
            color: #1A3C34;
        }
    </style>
    <script type="importmap">
{
  "imports": {
    "react-router-dom": "https://esm.sh/react-router-dom@^7.11.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3",
    "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@^2.89.0",

    "react-signature-canvas": "https://esm.sh/react-signature-canvas@^1.1.0-alpha.2"
  }
}
</script>
</head>

<body>
    <div id="root">
        <div id="fallback-message">
            <h1 style="font-size: 24px; font-weight: bold;">Wellness, The Hannam</h1>
            <p>Loading...</p>
            <p style="font-size: 12px; color: #999;">화면이 멈춰있다면 아래 버튼을 눌러주세요</p>
            <button onclick="window.location.href='/?t='+Date.now()"
                style="padding: 10px 20px; background: #1A3C34; color: white; border-radius: 8px; border: none;">새로고침</button>
        </div>
    </div>
    <script type="module" src="index.tsx"></script>
    <script>
        // [CRITICAL FIX] Service Worker Management & Kakao Compatibility
        // Version: 2026.01.27.v8 (Kakao Exclusion + HTML Fallback)
        (async function () {
            const ua = navigator.userAgent;
            const isKakao = /KAKAOTALK|DaumApps/i.test(ua);

            // 1. KAKAOTALK/NATIVE APP SPECIFIC FIX: KILL SWs & DISABLE
            // Kakao in-app browser hates Service Workers -> White Screen.
            if (isKakao) {
                console.warn('[System] Native App (Kakao) detected. Disabling Service Workers.');

                // Unregister existing workers immediately
                if ('serviceWorker' in navigator) {
                    try {
                        const registrations = await navigator.serviceWorker.getRegistrations();
                        for (const registration of registrations) {
                            await registration.unregister();
                            console.log('Kakao SW Unregistered');
                        }
                    } catch (e) {
                        console.error('SW Unregister Failed', e);
                    }
                }

                // NUCLEAR OPTION: Delete the API entirely so React/Firebase CANNOT register anything
                // This prevents the "hanging" during registration
                try {
                    Object.defineProperty(navigator, 'serviceWorker', {
                        value: undefined,
                        writable: false,
                        configurable: false
                    });
                    console.log('[System] navigator.serviceWorker has been NULLIFIED');
                } catch (e) {
                    console.error('Failed to nullify SW API', e);
                }

                // Force clear cache once for Kakao users to fix white screen
                const KAKAO_RESET = 'kakao_reset_v3';
                if (!localStorage.getItem(KAKAO_RESET) && 'caches' in window) {
                    caches.keys().then(keys => Promise.all(keys.map(k => caches.delete(k))))
                        .then(() => {
                            localStorage.setItem(KAKAO_RESET, 'true');
                            // Force Timestamp Reload to bypass Kakao Cache
                            window.location.href = '/?t=' + Date.now();
                        });
                }

                // IMPORTANT: Stop execution of any SW logic here.
                return;
            }

            // 2. GENERAL "KILL SWITCH" for Stale Cache (Non-Kakao)
            // Only runs once to fix white screen issues on other browsers.
            const RESET_KEY = 'wellness_reset_v20260127_final_v8'; // Bump version
            const hasReset = localStorage.getItem(RESET_KEY);

            if (!hasReset) {
                console.warn('[System] Executing Critical Cache & SW Cleanup (v8)...');
                try {
                    // Unregister all first to be safe
                    if ('serviceWorker' in navigator) {
                        const registrations = await navigator.serviceWorker.getRegistrations();
                        for (const registration of registrations) {
                            await registration.unregister();
                        }
                    }
                    // Clear Cache
                    if ('caches' in window) {
                        const keys = await caches.keys();
                        await Promise.all(keys.map(key => caches.delete(key)));
                    }
                    // Reload
                    localStorage.setItem(RESET_KEY, 'true');
                    window.location.href = '/?t=' + Date.now();
                } catch (e) {
                    console.error('[System] Cleanup Failed:', e);
                }
            } else {
                console.log('[System] Service Worker & Cache status: Clean (v8 verified)');
            }
        })();
    </script>
</body>

</html>